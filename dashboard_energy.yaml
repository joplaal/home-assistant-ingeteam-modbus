views:
  - type: sections
    max_columns: 4
    title: Energía
    path: flow
    sections:
      - type: grid
        cards:
          - type: custom:power-flow-card-plus
            entities:
              battery:
                entity:
                  consumption: sensor.ingeteam_battery_discharging_power
                  production: sensor.ingeteam_battery_charging_power
                state_of_charge: sensor.ingeteam_battery_state_of_charge
                show_state_of_charge: true
                color:
                  consumption:
                    - 57
                    - 184
                    - 40
                  production:
                    - 57
                    - 184
                    - 40
              grid:
                entity: sensor.ingeteam_grid_power_balance
                secondary_info: {}
              solar:
                entity: sensor.ingeteam_pv_internal_total_power
                display_zero_state: true
                secondary_info:
                  color_value: false
                  icon: ''
                invert_state: false
              home:
                secondary_info:
                  icon: mdi:lightbulb
                  color_value: false
                  unit_white_space: true
                entity: sensor.ingeteam_total_loads_power
                override_state: false
                hide: false
              individual:
                - entity: sensor.cargador_v2c_potencia_de_carga
                  secondary_info: {}
                  name: Cargador EV
                  icon: mdi:car
                - entity: sensor.ingeteam_critical_loads_active_power
                  secondary_info: {}
                  name: Críticas
                  color_value: false
                  icon: mdi:lightbulb
                  color:
                    - 225
                    - 35
                    - 35
            clickable_entities: true
            display_zero_lines:
              mode: transparency
              transparency: 85
              grey_color:
                - 189
                - 189
                - 189
            use_new_flow_rate_model: true
            w_decimals: 0
            kw_decimals: 1
            min_flow_rate: 0.75
            max_flow_rate: 6
            max_expected_power: 10000
            min_expected_power: 0.01
            watt_threshold: 1000
            transparency_zero_lines: 0
            sort_individual_devices: false
            grid_options:
              rows: 7
              columns: 24
            disable_dots: false
            title: Energía
          - type: custom:plotly-graph
            title: Fuentes
            grid_options:
              columns: full
            defaults:
              entity:
                type: scatter
                mode: lines
                stackgroup: energy
                fill: tonexty
                line:
                  width: 0
                  shape: spline
                  smoothing: 0.1
                hovertemplate: |
                  $fn ({ get }) => (
                    `%{y:,.0f} ${get('.unit_of_measurement')}<extra>${get('.name')}</extra>`
                  )
              yaxes:
                rangemode: nonnegative
                zeroline: true
                fixedrange: true
            hours_to_show: current_day
            extend_to_present: true
            autorange_after_scroll: true
            refresh_interval: auto
            entities:
              - entity: sensor.ingeteam_pv_total_power
                name: FV
                fill: tozeroy
                line:
                  color: '#FFA62B'
                filters:
                  - resample: 1m
                  - force_numeric
                  - filter: +y > 0
              - entity: sensor.ingeteam_battery_discharging_power
                name: Batería descarga
                line:
                  color: '#2ECC71'
                filters:
                  - resample: 1m
                  - force_numeric
                  - filter: +y > 0
              - entity: sensor.ingeteam_grid_power_balance
                name: Red (import)
                line:
                  color: '#1E88E5'
                opacity: 0.85
                filters:
                  - resample: 1m
                  - force_numeric
                  - map_y_numbers: Math.max(0, +y)
                  - filter: +y > 0
              - entity: sensor.ingeteam_pv_total_power
                internal: true
                period: 5minute
                filters:
                  - resample: 1m
                  - force_numeric
                  - integrate: h
                  - multiply: 0.001
                  - store_var: pv_kwh
              - entity: sensor.ingeteam_battery_discharging_power
                internal: true
                period: 5minute
                filters:
                  - resample: 1m
                  - force_numeric
                  - integrate: h
                  - multiply: 0.001
                  - store_var: bat_discharge_kwh
              - entity: sensor.ingeteam_grid_power_balance
                internal: true
                period: 5minute
                filters:
                  - resample: 1m
                  - force_numeric
                  - map_y_numbers: Math.max(0, +y)
                  - integrate: h
                  - multiply: 0.001
                  - store_var: grid_kwh
            layout:
              height: 420
              margin:
                t: 60
                r: 10
                b: 70
                l: 45
              legend:
                orientation: h
                x: 0
                xanchor: left
                'y': -0.2
                yanchor: top
              title:
                text: |
                  $ex {
                    const fmt = (v) => `${((v ?? 0)).toFixed(2)} kWh`;
                    const pv = vars.pv_kwh?.ys?.at(-1);
                    const bd = vars.bat_discharge_kwh?.ys?.at(-1);
                    const gr = vars.grid_kwh?.ys?.at(-1);
                    return `Total · FV: ${fmt(pv)} • Bat↓: ${fmt(bd)} • Red: ${fmt(gr)}`;
                  }
                x: 0
                xanchor: left
                font:
                  size: 12
              xaxis:
                range:
                  - $ex new Date().setHours(0,0,0,0)
                  - $ex Date.now()
                rangeselector:
                  buttons:
                    - count: 1
                      step: hour
                      stepmode: backward
                      label: 1h
                    - count: 1
                      step: day
                      stepmode: todate
                      label: Hoy
                    - count: 2
                      step: day
                      stepmode: todate
                      label: Ayer
                    - count: 3
                      step: day
                      stepmode: todate
                      label: Anteayer
                    - count: 7
                      step: day
                      stepmode: todate
                      label: Semana
                showspikes: false
                spikemode: across
                spikethickness: -2
            config:
              scrollZoom: true
          - type: custom:plotly-graph
            title: Cargas
            grid_options:
              columns: full
            defaults:
              entity:
                type: scatter
                mode: lines
                stackgroup: loads
                fill: tonexty
                line:
                  width: 0
                  shape: spline
                  smoothing: 0.1
                hovertemplate: |
                  $fn ({ get }) => (
                    `%{y:,.0f} ${get('.unit_of_measurement')}<extra>${get('.name')}</extra>`
                  )
              yaxes:
                rangemode: nonnegative
                zeroline: true
                fixedrange: true
            hours_to_show: current_day
            autorange_after_scroll: true
            refresh_interval: auto
            entities:
              - entity: sensor.ingeteam_total_loads_power
                internal: true
                period: 5minute
                filters:
                  - resample: 1m
                  - force_numeric
                  - store_var: loads_total
                  - integrate: h
                  - multiply: 0.001
                  - store_var: loads_total_kwh
              - entity: sensor.ingeteam_critical_loads_active_power
                internal: true
                period: 5minute
                filters:
                  - resample: 1m
                  - force_numeric
                  - store_var: loads_critical
                  - integrate: h
                  - multiply: 0.001
                  - store_var: loads_critical_kwh
              - entity: sensor.cargador_v2c_potencia_de_carga
                internal: true
                period: 5minute
                filters:
                  - resample: 1m
                  - force_numeric
                  - store_var: loads_v2c
                  - integrate: h
                  - multiply: 0.001
                  - store_var: loads_v2c_kwh
              - entity: sensor.ingeteam_battery_charging_power
                internal: true
                period: 5minute
                filters:
                  - resample: 1m
                  - force_numeric
                  - integrate: h
                  - multiply: 0.001
                  - store_var: bat_charge_kwh
              - entity: sensor.ingeteam_battery_charging_power
                name: Batería carga
                fill: tozeroy
                line:
                  color: '#2ECC71'
                opacity: 0.85
                filters:
                  - resample: 1m
                  - force_numeric
                  - filter: +y > 0
              - entity: sensor.ingeteam_grid_power_balance
                name: Inyección a red
                line:
                  color: '#9C27B0'
                filters:
                  - resample: 1m
                  - force_numeric
                  - multiply: -1
                  - filter: +y > 0
              - entity: sensor.cargador_v2c_potencia_de_carga
                name: Cargador VE
                line:
                  color: '#1E88E5'
                filters:
                  - resample: 1m
                  - force_numeric
                  - filter: +y > 0
              - entity: sensor.ingeteam_critical_loads_active_power
                name: Cargas críticas
                line:
                  color: '#EF5350'
                filters:
                  - resample: 1m
                  - force_numeric
                  - filter: +y > 0
              - entity: sensor.ingeteam_total_loads_power
                name: Resto de cargas
                line:
                  color: '#616161'
                filters:
                  - resample: 1m
                  - force_numeric
                  - fn: |
                      ({ xs, vars }) => {
                        const t = vars.loads_total?.ys || [];
                        const c = vars.loads_critical?.ys || [];
                        const v = vars.loads_v2c?.ys || [];
                        const ys = t.map((tv, i) => Math.max(0, (+tv || 0) - (+c[i] || 0) - (+v[i] || 0)));
                        return { ys };
                      }
                  - force_numeric
                  - filter: +y > 0
            layout:
              height: 420
              margin:
                t: 60
                r: 10
                b: 70
                l: 45
              legend:
                orientation: h
                x: 0
                xanchor: left
                'y': -0.2
                yanchor: top
              title:
                text: |
                  $ex {
                    const fmt = (v) => `${((v ?? 0)).toFixed(2)} kWh`;
                    const tot = vars.loads_total_kwh?.ys?.at(-1) ?? 0;
                    const cri = vars.loads_critical_kwh?.ys?.at(-1) ?? 0;
                    const ev  = vars.loads_v2c_kwh?.ys?.at(-1) ?? 0;
                    const bc  = vars.bat_charge_kwh?.ys?.at(-1) ?? 0;
                    const rest = Math.max(0, tot - cri - ev);
                    return `Total · Resto: ${fmt(rest)} • Críticas: ${fmt(cri)} • Cargador VE: ${fmt(ev)} • Bat↑: ${fmt(bc)}`;
                  }
                x: 0
                xanchor: left
                font:
                  size: 12
              xaxis:
                range:
                  - $ex new Date().setHours(0,0,0,0)
                  - $ex Date.now()
                rangeselector:
                  buttons:
                    - count: 1
                      step: hour
                      stepmode: backward
                      label: 1h
                    - count: 1
                      step: day
                      stepmode: todate
                      label: Hoy
                    - count: 2
                      step: day
                      stepmode: todate
                      label: Ayer
                    - count: 3
                      step: day
                      stepmode: todate
                      label: Anteayer
                    - count: 7
                      step: day
                      stepmode: todate
                      label: Semana
                showspikes: false
                spikemode: across
                spikethickness: -2
            config:
              scrollZoom: true
          - type: custom:plotly-graph
            title: Batería
            grid_options:
              columns: full
            defaults:
              entity:
                mode: lines
                line:
                  width: 0
                  shape: spline
                  smoothing: 0.1
                hovertemplate: |
                  $fn ({ get }) => (
                    `%{y:,.0f} ${get('.unit_of_measurement')}<extra>${get('.name')}</extra>`
                  )
            hours_to_show: current_day
            extend_to_present: true
            autorange_after_scroll: true
            refresh_interval: auto
            entities:
              - entity: sensor.ingeteam_battery_charging_power
                name: Carga
                type: scatter
                fill: tozeroy
                line:
                  color: '#2ECC71'
                filters:
                  - resample: 1m
                  - force_numeric
              - entity: sensor.ingeteam_battery_discharging_power
                name: Descarga
                type: scatter
                fill: tozeroy
                line:
                  color: '#2ECC71'
                filters:
                  - resample: 1m
                  - force_numeric
                  - multiply: -1
              - entity: sensor.ingeteam_battery_state_of_charge
                name: SOC
                yaxis: y2
                line:
                  color: '#9E9E9E'
                  width: 3
                  dash: dot
                filters:
                  - resample: 1m
                  - force_numeric
                  - store_var: soc
            layout:
              height: 420
              margin:
                t: 60
                r: 45
                b: 70
                l: 45
              legend:
                orientation: h
                x: 0
                xanchor: left
                'y': -0.2
                yanchor: top
              title:
                text: |
                  $ex {
                    const soc = vars.soc?.ys?.at(-1);
                    return `Valor actual SOC: ${soc !== undefined ? parseFloat(soc).toFixed(0) : '--'} %`;
                  }
                x: 0
                xanchor: left
                font:
                  size: 12
              yaxis:
                title: Potencia (W)
                fixedrange: true
              yaxis2:
                title: SOC (%)
                overlaying: 'y'
                side: right
                fixedrange: true
                range:
                  - 0
                  - 100
              xaxis:
                range:
                  - $ex new Date().setHours(0,0,0,0)
                  - $ex Date.now()
                rangeselector:
                  buttons:
                    - count: 1
                      step: hour
                      stepmode: backward
                      label: 1h
                    - count: 1
                      step: day
                      stepmode: todate
                      label: Hoy
                    - count: 2
                      step: day
                      stepmode: todate
                      label: Ayer
                    - count: 3
                      step: day
                      stepmode: todate
                      label: Anteayer
                    - count: 7
                      step: day
                      stepmode: todate
                      label: Semana
                showspikes: false
                spikemode: across
                spikethickness: -2
            config:
              scrollZoom: true
        column_span: 2
      - type: grid
        cards:
          - type: heading
            heading: Debug
            heading_style: title
          - type: entity
            entity: sensor.ingeteam_status
            name: Estado inversor
            grid_options:
              columns: 6
              rows: 3
          - graph: line
            type: sensor
            detail: 1
            entity: sensor.ingeteam_system_efficiency
            name: Ratio autoconsumo
            hours_to_show: 24
            grid_options:
              columns: 6
              rows: 3
          - graph: line
            type: sensor
            entity: sensor.ingeteam_pv_internal_total_power
            detail: 2
            icon: mdi:solar-power-variant-outline
            name: Fotovoltaica
            grid_options:
              rows: 3
            hours_to_show: 24
          - type: entities
            entities:
              - entity: sensor.ingeteam_pv1_power
                name: PV1
              - entity: sensor.ingeteam_pv2_power
                name: PV2
            title: Producción solar
            grid_options:
              columns: 6
              rows: 3
          - type: entity
            entity: sensor.ingeteam_battery_status
            name: Estado batería
            grid_options:
              columns: 6
              rows: 3
          - graph: line
            type: sensor
            detail: 2
            entity: sensor.ingeteam_battery_state_of_charge
            name: Batería SOC %
            grid_options:
              rows: 3
              columns: 6
            hours_to_show: 24
          - graph: line
            type: sensor
            detail: 2
            entity: sensor.ingeteam_battery_charging_power
            grid_options:
              rows: 3
            icon: mdi:battery-plus-variant
            name: Carga de batería
            hours_to_show: 24
          - graph: line
            type: sensor
            detail: 2
            entity: sensor.ingeteam_battery_discharging_power
            grid_options:
              rows: 3
            icon: mdi:battery-minus-variant
            name: Descarga de batería
            hours_to_show: 24
          - graph: line
            type: sensor
            detail: 2
            name: Red
            entity: sensor.ingeteam_grid_power_balance
            icon: mdi:transmission-tower-import
            grid_options:
              rows: 3
            hours_to_show: 24
          - graph: line
            type: sensor
            detail: 2
            entity: sensor.ingeteam_total_loads_power
            grid_options:
              rows: 3
              columns: 6
            name: Cargas totales
            icon: mdi:home-lightning-bolt
            hours_to_show: 24
          - graph: line
            type: sensor
            detail: 2
            entity: sensor.ingeteam_critical_loads_active_power
            grid_options:
              columns: 6
              rows: 3
            name: Cargas críticas
            icon: mdi:laptop
            hours_to_show: 24
          - type: entities
            entities:
              - entity: sensor.ingeteam_critical_loads_power_l1
                name: L1
              - entity: sensor.ingeteam_critical_loads_power_l2
                name: L2
              - entity: sensor.ingeteam_critical_loads_power_l3
                name: L3
            title: Críticas por fase
            grid_options:
              columns: 6
              rows: auto
          - type: custom:plotly-graph
            title: Cargas críticas por fase
            grid_options:
              columns: full
            defaults:
              entity:
                type: scatter
                mode: lines
                line:
                  width: 2
                  shape: spline
                  smoothing: 0.1
                hovertemplate: |
                  $fn ({ get }) => (
                    `%{y:,.0f} ${get('.unit_of_measurement')}<extra>${get('.name')}</extra>`
                  )
              yaxes:
                rangemode: nonnegative
                zeroline: true
                fixedrange: true
            hours_to_show: current_day
            extend_to_present: true
            autorange_after_scroll: true
            refresh_interval: auto
            entities:
              - entity: sensor.ingeteam_critical_loads_power_l1
                name: L1
                line:
                  color: '#EF5350'
                filters:
                  - resample: 10s
                  - force_numeric
                  - store_var: l1
                  - filter: +y > 0
              - entity: sensor.ingeteam_critical_loads_power_l2
                name: L2
                line:
                  color: '#FFCA28'
                filters:
                  - resample: 10s
                  - force_numeric
                  - store_var: l2
                  - filter: +y > 0
              - entity: sensor.ingeteam_critical_loads_power_l3
                name: L3
                line:
                  color: '#42A5F5'
                filters:
                  - resample: 10s
                  - force_numeric
                  - store_var: l3
                  - filter: +y > 0
            layout:
              height: 420
              margin:
                t: 60
                r: 10
                b: 70
                l: 45
              legend:
                orientation: h
                x: 0
                xanchor: left
                'y': -0.2
                yanchor: top
              title:
                text: |
                  $ex {
                    const fmt = (v) => `${((v ?? 0)).toFixed(0)} W`;
                    const l1 = vars.l1?.ys?.at(-1);
                    const l2 = vars.l2?.ys?.at(-1);
                    const l3 = vars.l3?.ys?.at(-1);
                    return `L1: ${fmt(l1)} • L2: ${fmt(l2)} • L3: ${fmt(l3)}`;
                  }
                x: 0
                xanchor: left
                font:
                  size: 12
              xaxis:
                range:
                  - $ex new Date().setHours(0,0,0,0)
                  - $ex Date.now()
                rangeselector:
                  buttons:
                    - count: 1
                      step: hour
                      stepmode: backward
                      label: 1h
                    - count: 1
                      step: day
                      stepmode: todate
                      label: Hoy
                    - count: 2
                      step: day
                      stepmode: todate
                      label: Ayer
                    - count: 3
                      step: day
                      stepmode: todate
                      label: Anteayer
                    - count: 7
                      step: day
                      stepmode: todate
                      label: Semana
                showspikes: false
                spikemode: across
                spikethickness: -2
            config:
              scrollZoom: true
        column_span: 2
      - type: grid
        cards:
          - type: heading
            heading: Monitorización
            heading_style: title
          - type: grid
            columns: 2
            cards:
              - type: vertical-stack
                cards:
                  - type: markdown
                    title: Niveles SOC
                    content: >
                      <table>

                      <tr><td><ha-icon icon="mdi:battery-high"></ha-icon>
                      <b>Máximo</b></td><td align="right">{{
                      states('sensor.ingeteam_config_soc_max') }} %</td></tr>

                      <tr><td><ha-icon icon="mdi:battery-sync"></ha-icon>
                      <b>Recup.</b></td><td align="right">{{
                      states('sensor.ingeteam_config_soc_recovery') }}
                      %</td></tr>

                      <tr><td><ha-icon icon="mdi:battery-low"></ha-icon>
                      <b>Mínimo</b></td><td align="right">{{
                      states('number.ingeteam_config_soc_min') }} %</td></tr>

                      <tr><td><ha-icon
                      icon="mdi:battery-plus-outline"></ha-icon>
                      <b>Recx</b></td><td align="right">{{
                      states('sensor.ingeteam_config_soc_recx') }} %</td></tr>

                      <tr><td><ha-icon
                      icon="mdi:battery-minus-outline"></ha-icon>
                      <b>Descx</b></td><td align="right">{{
                      states('sensor.ingeteam_config_soc_descx') }} %</td></tr>

                      </table>
                  - type: markdown
                    title: Auto SOC
                    content: >
                      <table>

                      <tr><td><ha-icon icon="mdi:weather-pouring"></ha-icon>
                      <b>Alerta AEMET</b></td><td align="right">{% if
                      is_state('automation.ingeteam_soc_min_aemet_alert', 'on')
                      %}<ha-icon icon="mdi:check-circle" style="color:
                      #4CAF50;"></ha-icon>{% else %}<ha-icon
                      icon="mdi:close-circle" style="color:
                      #F44336;"></ha-icon>{% endif %}</td></tr>

                      <tr><td><ha-icon icon="mdi:battery-alert"></ha-icon>
                      <b>SOC (Alerta)</b></td><td align="right">{{
                      states('input_number.ingeteam_automation_soc_min_aemet_alert_true')
                      }} %</td></tr>

                      <tr><td><ha-icon icon="mdi:battery-check"></ha-icon>
                      <b>SOC (No Alerta)</b></td><td align="right">{{
                      states('input_number.ingeteam_automation_soc_min_aemet_alert_false')
                      }} %</td></tr>

                      <tr><td><ha-icon icon="mdi:water-percent-alert"></ha-icon>
                      <b>Nivel</b></td><td align="right">{{
                      states('sensor.nivel_alerta_precipataciones_valencia')
                      }}</td></tr>

                      </table>
              - type: vertical-stack
                cards:
                  - type: markdown
                    title: Carga SOC
                    content: >
                      <table>

                      <tr><td><ha-icon icon="mdi:flash"></ha-icon> <b>Potencia
                      AC</b></td><td align="right">{{
                      states('sensor.ingeteam_config_soc_ac_charging_power') }}
                      W</td></tr>

                      </table>
                  - type: markdown
                    title: Horario 1
                    content: >
                      <table>

                      <tr><td><ha-icon icon="mdi:calendar-clock"></ha-icon>
                      <b>Tipo</b></td><td align="right">{{
                      states('select.ingeteam_horario_1_tipo') }}</td></tr>

                      <tr><td><ha-icon icon="mdi:battery-charging-50"></ha-icon>
                      <b>Objetivo</b></td><td align="right">{{
                      states('number.ingeteam_config_soc_ac_charging_soc_grid1')
                      }} %</td></tr>

                      <tr><td><ha-icon icon="mdi:clock-start"></ha-icon>
                      <b>Inicio</b></td><td align="right">{{
                      states('time.ingeteam_config_soc_ac_charging_time_start1')[:5]
                      }}</td></tr>

                      <tr><td><ha-icon icon="mdi:clock-end"></ha-icon>
                      <b>Fin</b></td><td align="right">{{
                      states('time.ingeteam_config_soc_ac_charging_time_end1')[:5]
                      }}</td></tr>

                      </table>
                  - type: markdown
                    title: Horario 2
                    content: >
                      <table>

                      <tr><td><ha-icon icon="mdi:calendar-clock"></ha-icon>
                      <b>Tipo</b></td><td align="right">{{
                      states('select.ingeteam_horario_2_tipo') }}</td></tr>

                      <tr><td><ha-icon icon="mdi:battery-charging-50"></ha-icon>
                      <b>Objetivo</b></td><td align="right">{{
                      states('number.ingeteam_config_soc_ac_charging_soc_grid2')
                      }} %</td></tr>

                      <tr><td><ha-icon icon="mdi:clock-start"></ha-icon>
                      <b>Inicio</b></td><td align="right">{{
                      states('time.ingeteam_config_soc_ac_charging_time_start2')[:5]
                      }}</td></tr>

                      <tr><td><ha-icon icon="mdi:clock-end"></ha-icon>
                      <b>Fin</b></td><td align="right">{{
                      states('time.ingeteam_config_soc_ac_charging_time_end2')[:5]
                      }}</td></tr>

                      </table>
                  - type: markdown
                    title: Auto Carga
                    content: >
                      <table>

                      <tr><td><ha-icon icon="mdi:robot"></ha-icon> <b>Auto
                      Forecast</b></td><td align="right">{% if
                      is_state('automation.ingeteam_charge_low_sun_forecast',
                      'on') %}<ha-icon icon="mdi:check-circle" style="color:
                      #4CAF50;"></ha-icon>{% else %}<ha-icon
                      icon="mdi:close-circle" style="color:
                      #F44336;"></ha-icon>{% endif %}</td></tr>

                      <tr><td><ha-icon icon="mdi:power"></ha-icon>
                      <b>Activado</b></td><td align="right">{% if
                      is_state('input_boolean.ingeteam_charge_activated_by_forecast',
                      'on') %}<ha-icon icon="mdi:check-circle" style="color:
                      #4CAF50;"></ha-icon>{% else %}<ha-icon
                      icon="mdi:close-circle" style="color:
                      #F44336;"></ha-icon>{% endif %}</td></tr>

                      <tr><td><ha-icon icon="mdi:weather-sunny"></ha-icon>
                      <b>Mañana</b></td><td align="right">{{
                      states('sensor.energy_production_tomorrow') }}
                      kWh</td></tr>

                      <tr><td><ha-icon icon="mdi:chart-line"></ha-icon>
                      <b>Umbral</b></td><td align="right">{{
                      states('input_number.ingeteam_automation_solar_forecast_threshold')
                      }} kWh</td></tr>

                      </table>
            grid_options:
              columns: 24
              rows: auto
        column_span: 2
    cards: []
  - type: sections
    title: Configuración
    path: config
    sections:
      - type: grid
        cards:
          - type: heading
            heading: Configuración
            heading_style: title
          - type: entities
            title: Configuración niveles SOC
            entities:
              - entity: sensor.ingeteam_config_soc_max
                name: SOC Máximo (Carga máx)
              - entity: sensor.ingeteam_config_soc_recovery
                name: SOC Recuperación (Reinicio descarga)
              - entity: number.ingeteam_config_soc_min
                name: SOC Mínimo (Paro descarga)
              - entity: sensor.ingeteam_config_soc_recx
                name: SOC Recx (Reinicio aislada)
              - entity: sensor.ingeteam_config_soc_descx
                name: SOC Descx (Paro aislada)
              - type: section
                label: Automatización
              - entity: automation.ingeteam_soc_min_aemet_alert
              - entity: input_number.ingeteam_automation_soc_min_aemet_alert_true
              - entity: input_number.ingeteam_automation_soc_min_aemet_alert_false
              - entity: sensor.nivel_alerta_precipataciones_valencia
            grid_options:
              columns: 12
              rows: auto
          - type: entities
            title: Configuración Carga SOC
            entities:
              - entity: sensor.ingeteam_config_soc_ac_charging_power
                name: Potencia Carga AC (Máx desde Red)
              - type: section
                label: Horario 1
              - entity: select.ingeteam_horario_1_tipo
                name: Tipo
              - entity: number.ingeteam_config_soc_ac_charging_soc_grid1
                name: SOC Objetivo (Mantener)
              - entity: time.ingeteam_config_soc_ac_charging_time_start1
                name: Inicio
              - entity: time.ingeteam_config_soc_ac_charging_time_end1
                name: Fin
              - type: section
                label: Horario 2
              - entity: select.ingeteam_horario_2_tipo
                name: Tipo
              - entity: number.ingeteam_config_soc_ac_charging_soc_grid2
                name: SOC Objetivo (Mantener)
              - entity: time.ingeteam_config_soc_ac_charging_time_start2
                name: Inicio
              - entity: time.ingeteam_config_soc_ac_charging_time_end2
                name: Fin
              - type: section
                label: Automatización
              - entity: automation.ingeteam_charge_low_sun_forecast
              - entity: input_boolean.ingeteam_charge_activated_by_forecast
              - entity: sensor.energy_production_tomorrow
              - entity: input_number.ingeteam_automation_solar_forecast_threshold
            grid_options:
              columns: 12
              rows: auto
        column_span: 2
    cards: []
